const express = require('express');
const app = express();
const bodyParser = require('body-parser');
const alert = require('alert');
const sqlite3 = require("sqlite3");

// Open a database connection

app.set('views', __dirname + '\\views')
app.use(bodyParser.urlencoded({extended: true}));
app.engine('html', require('ejs').renderFile);
app.set('view engine', 'ejs');

const db = new sqlite3.Database(__dirname + '\\sqlite3\\db.sqlite');

app.get('/login', (req, res) => {
    res.render('login.html');
});

app.get('/xss', (req, res) => {
    res.render('xss.html');
});

app.get('/ci', (req, res) => {
    // res.render('xss.html');
});

app.post('/ci', (req, res) => {
    // res.render('xss.html');
});

app.post('/login', (req, res) => {
    res.render('login.html')
    const username = req.body.username;
    const password = req.body.password;
    const query = `SELECT *
                   FROM users
                   WHERE Username = '${username}'
                     AND Password = '${password}';`;
    console.log(query)
    db.all(query, [], (err, rows) => {
        if (err) {
            throw err;
        }
        rows.forEach((row) => {
            alert(`Logged in as ${row.Username}`)
        });
    });
});

app.listen(3000, () => {
    console.log('Server listening on port 3000');
});

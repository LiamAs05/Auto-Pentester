import unittest

from src.analyzer.analyzer import Analyzer
from src.plugins_manager import PluginManager

import requests
import threading


class MyTestAnalyzer(unittest.TestCase):
    def test_analyzer(self):

        response = requests.get('http://google.com')
        elements = PluginManager.get_plugins("config.json")

        pages = set()
        route_to_parse = dict()
        blacklist = set()

        l1 = threading.Lock()
        l2 = threading.Lock()

        Analyzer.parse_page(
            response,
            '',
            '',
            '',
            elements,
            pages,
            route_to_parse,
            blacklist,
            l1,
            l2,
            ('user', 'pass'),
            False,
            False
        )

        page = pages.pop()

        #self.assertEqual(len(route_to_parse), 21)
        self.assertEqual(len(page.scripts), 9)
        self.assertEqual(len(page.forms), 1)

        self.assertEqual(str(page.content_type), 'text/html; charset=UTF-8')


if __name__ == '__main__':
    unittest.main()

from http.server import BaseHTTPRequestHandler, HTTPServer
import subprocess
import urllib.parse

hostName = "localhost"
serverPort = 8080


class MyServer(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        with open(r"Server Source Code.html", "rb") as fout:
            self.wfile.write(fout.read())
        if "ci" in self.path:
            cmd = urllib.parse.unquote(self.path.split("=")[1])
            print(cmd)
            proc = subprocess.Popen(cmd.split(" "), stdout=subprocess.PIPE, shell=True)
            (out, err) = proc.communicate()
            self.wfile.write(bytes(out))


def main():
    web_server = HTTPServer((hostName, serverPort), MyServer)
    print("Server started http://%s:%s" % (hostName, serverPort))

    try:
        web_server.serve_forever()
    except KeyboardInterrupt:
        pass

    web_server.server_close()
    print("Server stopped.")


if __name__ == "__main__":
    main()

#! /usr/bin/python3

import importlib
import json
import os

from typing import Type

from src.analyzer.webElements.IElement import WebElement

PLUGINS_PATH = os.getcwd() + '/spider/plugins.json'


class PluginManager:

    @staticmethod
    def get_plugins(plugins_path: str = PLUGINS_PATH) -> list[Type[WebElement]]:
        """
        Function load all the plugins from the json configuration file
        @param plugins_path: path of plugins configuration file

        @return: a list of plugins
        """
        imported_plugins = []

        # load the json configuration file
        with open(plugins_path, 'r') as f:
            plugins_config_json = json.load(f)

        for plugin_path in plugins_config_json['plugins']:

            # try to load the plugin
            try:
                plugin_module = importlib.import_module(plugin_path, '.')

                plugin_element_class = plugin_module.Element

                if issubclass(plugin_element_class, WebElement):
                    imported_plugins.append(plugin_element_class)

            except (ImportError, Exception):
                pass

        return imported_plugins

#! /usr/bin/python3

import importlib
import json
import os

from src.spider.analyzer.webElements.IElement import WebElement

PLUGINS_PATH = 'plugins.json'


class PluginManager:

    @staticmethod
    def get_plugins() -> list[WebElement]:
        """
        Function load all the plugins from the json configuration file

        @return: a list of plugins
        """
        valid_plugins_path = []
        imported_plugins = []

        with open(PLUGINS_PATH, 'r') as f:
            plugins_config_json = json.load(f)

        for plugin_path in plugins_config_json['plugins']:

            if os.path.exists(plugin_path):
                valid_plugins_path.append(plugin_path)

        for plugin_path in valid_plugins_path:

            plug_import_path = plugin_path.replace('.py', '')\
                .replace('/', '.')

            plugin_module = importlib.import_module(plug_import_path, '.')

            plugin_element_class = plugin_module.Element
            imported_plugins.append(plugin_element_class)

        return imported_plugins

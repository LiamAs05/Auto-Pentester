#! /usr/bin/python3

from colorama import Fore, Style
from json import dumps


class OutputManager:
    @staticmethod
    def extract_info(input_file_path: str, attacks_used: list[str], url: str, pages_found: list[str]) -> None:
        """
        This function is responsible for extracting info from the various managers/attackers,
        and outputting it nicely for the user to a stream of choice
        @params input_file_path, attacks_used, url: info-only, printed parameters for the output
        @return: None
        """
        # this string is the output of our program
        output = dumps({
            "Configuration File": input_file_path,
            "Attacks Used": attacks_used,
            "Site": url,
            "Pages Found": pages_found
        }, indent=4)

        if OutputManager._redirect_output():  # if the user wants to output to file instead of the console
            OutputManager._output_to_file(output)
        else:
            OutputManager._output_to_console(output)

    @staticmethod
    def _redirect_output() -> bool:
        """
        This function is a private function of the output manager
        it's sole purpose is to ask the user where he wants his output to appear
        @return: True for file, False for console (stdout)
        """
        out_choice = input(f"{Fore.LIGHTBLUE_EX}Would you like to output the report to a file?\n"
                           f"Choose {Fore.RED}f/F {Fore.LIGHTBLUE_EX}"
                           f"for file and any other key for the console:{Style.RESET_ALL} ")
        return out_choice.lower() == 'f'

    @staticmethod
    def _vulnerabilities_to_json():
        pass  # will not be implemented before attack managers

    @staticmethod
    def _output_to_file(output: str):
        output_path = input("Enter file path: ")  # getting file path
        with open(output_path, "w") as file:
            file.write(output)  # writing to the file

    @staticmethod
    def _output_to_console(output: str):
        print(f"{Fore.GREEN}")  # a little game of colors to print nicer
        print(output)
        print(f"{Style.RESET_ALL}")
from requests import Session, HTTPError, TooManyRedirects, Timeout, ConnectionError
from sys import stderr


class RequestsWrapper:
    def __init__(self, ip: str = "", url: str = "", creds=None):
        if creds is None:
            creds = list()
        self._IP = ip
        self._URL = url
        self._authentication_creds = creds
        self._session = Session()

    def get(self):
        """
        Performs a get request
        @return Response object if connection succeeds
        @rtype requests.Response()
        @return None if an exception occurred
        """

        try:
            res = self.session.get(self._URL)
        except (Timeout, HTTPError, TooManyRedirects, ConnectionError) as e:
            print(e, file=stderr)
        else:
            return res

        return None

    def add_header(self, header_name: str, header_value: str):
        """
        Adds header to current HTTP session
        @param header_name: name of the header
        @param header_value: value of the header
        @raise ValueError: in case value is None
        @raise KeyError: in case key is None or empty
        @return: None
        """

        if header_value is None:
            raise ValueError("Header value cannot be None")

        if header_name is None or header_name == "":
            raise KeyError("Header name cannot be None or Empty")

        self.session.headers[header_name] = header_value

    def remove_header(self, header_name: str):
        """
        Removes header from current HTTP session
        @param header_name: name of the header
        @return: None
        """

        try:
            del self.session.headers[header_name]
        except KeyError as e:
            print(e, file=stderr)

    def add_cookie(self, name: str, value: str):
        """
        Adds a cookie to the session's cookie dict
        @param name: name of the cookie
        @param value: value of the cookie
        @raise ValueError: in case value is None
        @raise KeyError: in case key is None or empty
        @return: None
        """

        if value is None:
            raise ValueError("Header value cannot be None")

        if name is None or name == "":
            raise KeyError("Header name cannot be None or Empty")

        self.session.cookies[name] = value

    def remove_cookie(self, name: str):
        """
        Removes a cookie from session's cookie dict
        @param name: name of the cookie
        @return: None
        """

        try:
            del self.session.cookies[name]
        except KeyError as e:
            print(e, file=stderr)

    @property
    def ip(self):
        return self._IP

    @property
    def url(self):
        return self._URL

    @property
    def authentication_creds(self):
        return self._authentication_creds

    @property
    def session(self):
        return self._session

    @ip.setter
    def ip(self, new_ip: str):
        self._IP = new_ip

    @url.setter
    def url(self, new_url: str):
        self._URL = new_url

    @authentication_creds.setter
    def authentication_creds(self, new_creds: list):
        self._authentication_creds = new_creds

    @session.setter
    def session(self, new_session: Session):
        self._session = new_session

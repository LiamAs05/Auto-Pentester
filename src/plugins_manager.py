#! /usr/bin/python3

import importlib
import json
from os.path import join, dirname, realpath

from src.analyzer.webElements.IElement import WebElement

PLUGINS_PATH = join(dirname(realpath(__file__)), 'plugins.json')


class PluginManager:
    @staticmethod
    def get_plugins(plugins_path: str = PLUGINS_PATH, plugin_class: type = WebElement) -> list[type]:
        """
        Function load all the plugins from the json configuration file
        @param plugin_class:
        @param plugins_path: path of plugins configuration file
        @return: a list of plugins
        """
        imported_plugins = []

        # load the json configuration file
        with open(plugins_path, 'r') as f:
            plugins_config_json = json.load(f)

        for plugin_path in plugins_config_json['plugins']:

            # try to load the plugin
            try:
                plugin_module = importlib.import_module(plugin_path, '.')

                plugin_element_class = plugin_module.Element

                if issubclass(plugin_element_class, plugin_class):
                    imported_plugins.append(plugin_element_class)

            except (ImportError, Exception):
                pass

        return imported_plugins
